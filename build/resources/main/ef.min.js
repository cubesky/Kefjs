!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.ef={})}(this,function(e){"use strict";var t=new RegExp("\\&[0-7]{1,3}","g"),r=new RegExp("\\&u\\[.*?\\]","g"),n=new RegExp("\\&u.{0,4}","g"),a=new RegExp("\\&x.{0,2}","g"),o=new RegExp("\\&","g"),i=new RegExp("\\&b","g"),s=new RegExp("\\&t","g"),u=new RegExp("\\&n","g"),c=new RegExp("\\&v","g"),l=new RegExp("\\&f","g"),p=new RegExp("\\&r","g"),f=function(){throw new SyntaxError("Octal escape sequences are not allowed in EFML.")},h=function(e){if(e=e.substr(3,e.length-4),!(e=parseInt(e,16)))throw new SyntaxError("Invalid Unicode escape sequence");try{return String.fromCodePoint(e)}catch(e){throw new SyntaxError("Undefined Unicode code-point")}},d=function(e){if(e=e.substring(2),!(e=parseInt(e,16)))throw new SyntaxError("Invalid Unicode escape sequence");return String.fromCharCode(e)},v=function(e){if(e="00"+e.substring(2),!(e=parseInt(e,16)))throw new SyntaxError("Invalid hexadecimal escape sequence");return String.fromCharCode(e)},g=function(e){for(var g=[],b=0,y=e.split("&&");b<y.length;b+=1){var m=y[b].replace(t,f).replace(r,h).replace(n,d).replace(a,v).replace(i,"\b").replace(s,"\t").replace(u,"\n").replace(c,"\v").replace(l,"\f").replace(p,"\r").replace(o,"");g.push(m)}return g.join("&")},b=function(e){return"&"===e[e.length-1]},y=function(e,t){for(var r=[],n=!1,a=0,o=e.split(t);a<o.length;a+=1){var i=o[a];n?r[r.length-1]+=""+t+i:r.push(i),n=b(i)}return r},m=function(e,t){for(var r=e.split("&&"),n=y(r.shift(),t),a=0,o=r;a<o.length;a+=1){var i=o[a],s=y(i,t);n[n.length-1]+="&&"+s.shift(),n.push.apply(n,s)}return n},N=["$ctx","$data","$refs","$methods","$mount","$umount","$subscribe","$unsubscribe","$update","$destroy","__DIRECTMOUNT__"],x=/\{\{.+?\}\}/g,E=/^(\t*)( *).*/,k=/#([^}]|}[^}])*$/,w=function(e,t){return void 0===t&&(t=-2),"Failed to parse eft template: "+e+". at line "+(t+1)},$=function(e){return["number","boolean","string"].indexOf(typeof e)>-1},D=function(e){if(!e)return[e,!1];try{var t=JSON.parse(e);return-1===["number","boolean"].indexOf(typeof t)?[g(e),!0]:[t,!1]}catch(t){return[g(e),!0]}},_=function(e){e=e.slice(2,e.length-2);var t=m(e,"="),r=t[0],n=t.slice(1),a=m(r.trim(),".").map(g),o=D(n.join("=").trim()),i=o[0],s=o[1];return $(i)&&(s||!s&&""!==i)?[a,i]:[a]},T=function(e){var t=e.split(x);if(1===t.length)return D(e)[0];var r=[];2!==t.length||t[0]||t[1]?r.push(t.map(g)):r.push(0);var n=e.match(x);return n&&r.push.apply(r,n.map(_)),r},O=function(e,t){t&&e.push(t)},R=function(e){return e.replace(/\./g," ")},A=function(e){var t=m(e,"=");return{name:g(t.shift().trim()),value:T(t.join("=").trim())}},S=function(e,t,r){var n=parseInt(r,10);if(isNaN(n))return function(e,t){switch(t){case"stop":e.s=1;break;case"stopImmediate":e.i=1;break;case"prevent":e.p=1;break;case"shift":e.h=1;break;case"alt":e.a=1;break;case"ctrl":e.c=1;break;case"meta":e.t=1;break;case"capture":e.u=1;break;default:console.warn("Abandoned unsupported eft event option '"+t+"'.")}}(e,g(r));t.push(n)},I=function(e){var t,r=e.line,n=e.ast,a=e.parsingInfo,o=e.i;if(r.replace(/\s/,"")){!function(e,t){null===t.offset&&(t.offset=e.match(/\s*/)[0],t.offset&&(t.offsetReg=t.offset))}(r,a);var i=function(e,t,r){if(t.offsetReg){var n=!1;if(e=e.replace(t.offsetReg,function(){return n=!0,""}),!n)throw new SyntaxError(w("Expected indent to be grater than 0 and less than "+(t.prevDepth+1)+", but got -1",r))}return e}(r,a,o);!function(e,t){if(!t.indentReg){var r=e.match(E)[2];r&&(t.indentReg=new RegExp(r,"g"))}}(i,a);var s=function(e,t,r){var n=0;t.indentReg&&(e=e.replace(/^\s*/,function(e){return e.replace(t.indentReg,"\t")}));var a=e.replace(/^\t*/,function(e){return n=e.length,""});if(/^\s/.test(a))throw new SyntaxError(w("Bad indent",r));return{depth:n,content:a}}(i,a,o),u=s.depth,c=s.content;if(c){if(u<0||u-a.prevDepth>1||u-a.prevDepth==1&&-1===["comment","tag"].indexOf(a.prevType)||"comment"!==a.prevType&&0===u&&a.topExists)throw new SyntaxError(w("Expected indent to be grater than 0 and less than "+(a.prevDepth+1)+", but got "+u,o));var l=c[0];if(c=c.slice(1),!a.topExists&&">#%@.-+".indexOf(l)>=0&&">"!==l)throw new SyntaxError(w("No top level entry",o));if(!c&&">#%@.-+".indexOf(l)>=0)throw new SyntaxError(w("Empty content",o));switch((u<a.prevDepth||u===a.prevDepth&&"tag"===a.prevType)&&(a.currentNode=function(e,t){for(var r=e,n=0;n<t;n++)r=r[r.length-1];return r}(n,u)),a.prevDepth=u,l){case">":a.topExists||(a.topExists=!0,a.minDepth=u);var p=function(e){var t={},r=m(e.replace(k,function(e){return t.ref=e.slice(1),""}),"."),n=r[0],a=r.slice(1);return t.tag=g(n),t.class=T(a.join(".")),"string"==typeof t.class?t.class=R(t.class).trim():t.class[0]&&(t.class[0]=t.class[0].map(R)),t}(c),f=[{t:p.tag}];p.class&&(f[0].a={},f[0].a.class=p.class),p.ref&&(f[0].r=p.ref),a.currentNode.push(f),a.currentNode=f,a.prevType="tag";break;case"#":var h=A(c),d=h.name,v=h.value;a.currentNode[0].a||(a.currentNode[0].a={}),a.currentNode[0].a[d]=v,a.prevType="attr";break;case"%":var b=A(c),y=b.name,x=b.value;a.currentNode[0].p||(a.currentNode[0].p={}),a.currentNode[0].p[y]=x,a.prevType="prop";break;case"@":var D=function(e){var t=m(e,"=");return{name:t.shift().trim(),value:t.join("=").trim()}}(c),_=D.name,I=D.value;a.currentNode[0].e||(a.currentNode[0].e=[]);var j=function(e){var t={},r=[],n=m(e,"."),a=n[0],o=n.slice(1);t.l=g(a);for(var i=0,s=o;i<s.length;i+=1){var u=s[i];S(t,r,u)}return r.length>0&&(t.k=r),t}(_),P=function(e){var t=m(e,":"),r=t[0],n=t.slice(1).join(":"),a=g(r.trim());return n?[a,T(n)]:[a]}(I),C=P[0],q=P[1];j.m=C,q&&(j.v=q),a.currentNode[0].e.push(j),a.prevType="event";break;case".":(t=a.currentNode).push.apply(t,function(e){var t=T(e);if($(t))return[""+t];for(var r=t[0],n=t.slice(1),a=[],o=0;o<n.length;o++)O(a,r[o]),a.push(n[o]);return O(a,r[r.length-1]),a}(c)),a.prevType="text";break;case"-":if(-1!==N.indexOf(c))throw new SyntaxError(w("Reserved name '"+c+"' should not be used",o));a.currentNode.push({n:c,t:0}),a.prevType="node";break;case"+":a.currentNode.push({n:c,t:1}),a.prevType="list";break;default:a.prevType="comment"}}}},j=function(e){if(!e)throw new TypeError(w("Template required, but nothing given"));var t=typeof e;if("string"!==t)throw new TypeError(w("Expected a string, but got a(n) "+t));for(var r=e.split(/\r?\n/),n=[],a={indentReg:null,prevDepth:0,offset:null,offsetReg:null,prevType:"comment",currentNode:n,topExists:!1},o=0;o<r.length;o++)I({line:r[o],ast:n,parsingInfo:a,i:o});if(n[0])return n[0];throw new SyntaxError(w("Nothing to be parsed",r.length-1))},P=function(e){return Array.isArray(e)?"array":typeof e},C=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var n="",a=0;a<t.length;a++)n+=e[a]+t[a];return n+e[e.length-1]},q=function(e){return e.dataNode[e._key]},F=Array.prototype,U={copy:function(e){return F.slice.call(e,0)},empty:function(e){return e.length=0,e},equals:function(e,t){if(!Array.isArray(t))return!1;if(e===t)return!0;if(e.length!==t.length)return!1;for(var r=0,n=e.length;r<n;r++)if(e[r]!==t[r])return!1;return!0},pop:function(e){return F.pop.call(e)},push:function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return F.push.apply(e,t)},remove:function(e,t){var r=F.indexOf.call(e,t);if(r>-1)return F.splice.call(e,r,1),t},reverse:function(e){return F.reverse.call(e)},rightUnique:function(e){for(var t=[],r=0;r<e.length;r++){for(var n=r+1;n<e.length;n++)e[r]===e[n]&&(n=r+=1);t.push(e[r])}return t},shift:function(e){return F.shift.call(e)},slice:function(e,t,r){return F.slice.call(e,t,r)},sort:function(e,t){return F.sort.call(e,t)},splice:function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return F.splice.apply(e,t)},unshift:function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];return F.unshift.apply(e,t)}};window.Set&&Array.from?U.unique=function(e){return Array.from(new Set(e))}:U.unique=U.rightUnique;var L=[],B=[],M=[],K=0,Z=function(e){return L.push.apply(L,e)},J=function(e){return B.push(e)},z=function(){return K+=1},G=function(){if(0!==M.length){for(var e=0,t=U.unique(M);e<t.length;e+=1){(0,t[e])()}U.empty(M)}},H=function(e){return!e&&(K-=1)>0?K:(K=0,L.length>0&&function(){for(var e=0,t=U.unique(L);e<t.length;e+=1)(0,t[e])();U.empty(L)}(),B.length>0&&function(){for(var e=0,t=U.rightUnique(B);e<t.length;e+=1)(0,t[e])();U.empty(B)}(),M.length>0&&setTimeout(G,0),K)},Q=Object.assign||function(e,t){for(var r in t)e[r]=t[r];return e},V=function(e,t,r){for(var n=0,a=e;n<a.length;n+=1){var o=a[n];if(!t[o]){var i={};Object.defineProperty(t,o,{get:function(){return i},set:function(e){z(),Q(i,e),H()},configurable:!r,enumerable:r})}t=t[o]}return t},W=[],X=function(e,t){!function(e){W.push(e)}(e),z();try{for(var r=0,n=e;r<n.length;r+=1){(0,n[r])(t)}}catch(e){console.error("[EF]","Error caught when executing subscribers:\n",e)}H(),function(e){U.remove(W,e)}(e)},Y=function(e){return e!=e},ee=function(e){var t=e.bind,r=e.state,n=e.handlers,a=e.subscribers,o=e.innerData,i=U.copy(t[0]),s=i.pop(),u=function(e){var t=e._path,r=e._key,n=e.data,a=e.handlers,o=e.subscribers,i=e.innerData,s=V(t,n,!0),u=function(e){for(var t=e._path,r=e.handlers,n=e.subscribers,a=e.innerData,o=0,i=t;o<i.length;o+=1){var s=i[o];r[s]||(r[s]={}),n[s]||(n[s]={}),a[s]||(a[s]={}),r=r[s],n=n[s],a=a[s]}return{handlerNode:r,subscriberNode:n,dataNode:a}}({_path:t,handlers:a,subscribers:o,innerData:i}),c=u.handlerNode,l=u.subscriberNode,p=u.dataNode;return c[r]||(c[r]=[]),l[r]||(l[r]=[]),Object.prototype.hasOwnProperty.call(p,r)||(p[r]=""),{parentNode:s,handlerNode:c[r],subscriberNode:l[r],dataNode:p}}({_path:i,_key:s,data:r.$data,handlers:n,subscribers:a,innerData:o}),c=u.parentNode,l=u.handlerNode,p=u.subscriberNode,f=u.dataNode;return Object.prototype.hasOwnProperty.call(c,s)||function(e){var t=e.parentNode,r=e.dataNode,n=e.handlerNode,a=e.subscriberNode,o=e.state,i=e._key;Object.defineProperty(t,i,{get:function(){return r[i]},set:function(e){r[i]===e||Y(r[i])&&Y(e)||(r[i]=e,z(),Z(n),H(),a.length>0&&X(a,{state:o,value:e}))},enumerable:!0})}({parentNode:c,dataNode:f,handlerNode:l,subscriberNode:p,state:r,_key:s}),t.length>1&&(c[s]=t[1]),{dataNode:f,parentNode:c,handlerNode:l,subscriberNode:p,_key:s}},te=function(e,t){void 0===t&&(t={bubbles:!1,cancelable:!1});var r=document.createEvent("Event");return r.initEvent(e,t.bubbles,t.cancelable),r},re=function(e){return["number","boolean","string"].indexOf(typeof e)>-1},ne=function(e){var t=e.tag,r=e.ref,n=e.refs,a=function(e,t){return t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e)}(t,e.svg);return r&&Object.defineProperty(n,r,{value:a,enumerable:!0}),a},ae=function(e){var t=e.val,r=e.state,n=e.handlers,a=e.subscribers,o=e.innerData,i=e.handler;if(Array.isArray(t)){var s=t[0],u=t.slice(1),c=[s],l=function(){return i(function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];if(!e)return q(t[0]);var n=[e];return n.push.apply(n,t.map(q)),C.apply(void 0,n)}.apply(void 0,c))};return c.push.apply(c,u.map(function(e){var t=ee({bind:e,state:r,handlers:n,subscribers:a,innerData:o}),i=t.dataNode,s=t.handlerNode,u=t._key;return s.push(l),{dataNode:i,_key:u}})),l}return function(){return t}},oe=function(e){var t=e.parentNode,r=e.handlerNode,n=e._handler,a=e._key,o=e.value;U.remove(r,n),z(),t[a]=o,H(),U.push(r,n)},ie=function(e){var t=e.element,r=e.attr,n=e.key,a=e.state,o=e.handlers,i=e.subscribers,s=e.innerData;if(re(r))t.setAttribute(n,r);else{var u=function(e,t){return"class"===t?function(r){if(!(r=(""+r).replace(/\s+/g," ").trim()))return e.removeAttribute(t);e.setAttribute(t,r)}:function(r){if(""===r)return e.removeAttribute(t);e.setAttribute(t,r)}}(t,n);Z([ae({val:r,state:a,handlers:o,subscribers:i,innerData:s,handler:u})])}},se=function(e){var t=e.element,r=e.prop,n=e.key,a=e.state,o=e.handlers,i=e.subscribers,s=e.innerData;if(re(r))t[n]=r;else{var u=ae({val:r,state:a,handlers:o,subscribers:i,innerData:s,handler:function(e){t[n]=e}});"value"!==n&&"checked"!==n||r[0]||function(e){var t=e._handler,r=e.state,n=e.handlers,a=e.subscribers,o=e.innerData,i=e.element,s=e.key,u=e.expr,c=ee({bind:u,state:r,handlers:n,subscribers:a,innerData:o}),l=c.parentNode,p=c.handlerNode,f=c._key,h=function(){return oe({parentNode:l,handlerNode:p,_handler:t,_key:f,value:i.value})};"value"===s?(i.addEventListener("input",h,!0),i.addEventListener("keyup",h,!0),i.addEventListener("change",h,!0)):(i.addEventListener("change",function(){if(i.dispatchEvent(te("ef-change-event")),"INPUT"===i.tagName&&"radio"===i.type&&""!==i.name){var e=document.querySelectorAll("input[name="+i.name+"]");if(e){var t=U.copy(e);U.remove(t,i);for(var r=0,n=t;r<n.length;r+=1)n[r].dispatchEvent(te("ef-change-event"))}}},!0),i.addEventListener("ef-change-event",function(){return oe({parentNode:l,handlerNode:p,_handler:t,_key:f,value:i.checked})}))}({_handler:u,state:a,handlers:o,subscribers:i,innerData:s,element:t,key:n,expr:r[1]}),Z([u])}},ue=function(e){return e},ce=function(e){var t=e.element,r=e.event,n=e.state,a=e.handlers,o=e.subscribers,i=e.innerData,s=r.l,u=r.m,c=r.s,l=r.i,p=r.p,f=r.h,h=r.a,d=r.c,v=r.t,g=r.u,b=r.k,y=r.v,m=ae({val:y,state:n,handlers:a,subscribers:o,innerData:i,handler:ue});t.addEventListener(s,function(e){!!f!=!!e.shiftKey||!!h!=!!e.altKey||!!d!=!!e.ctrlKey||!!v!=!!e.metaKey||b&&-1===b.indexOf(e.which)||(c&&e.stopPropagation(),l&&e.stopImmediatePropagation(),p&&e.preventDefault(),n.$methods[u]&&n.$methods[u]({e:e,value:m(),state:n}))},!!g)},le=Node.prototype,pe={before:function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var n=document.createDocumentFragment();t.reverse();for(var a=0,o=t;a<o.length;a+=1){var i=o[a];le.appendChild.call(n,i)}le.insertBefore.call(e.parentNode,n,e)},after:function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var n=document.createDocumentFragment(),a=0,o=t;a<o.length;a+=1){var i=o[a];le.appendChild.call(n,i)}e.nextSibling?le.insertBefore.call(e.parentNode,n,e.nextSibling):le.appendChild.call(e.parentNode,n)},append:function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];if(-1!==[1,9,11].indexOf(e.nodeType)){for(var n=document.createDocumentFragment(),a=0,o=t;a<o.length;a+=1){var i=o[a];le.appendChild.call(n,i)}le.appendChild.call(e,n)}},remove:function(e){le.removeChild.call(e.parentNode,e)}},fe={empty:function(){z();for(var e=0,t=U.copy(this);e<t.length;e+=1){t[e].$destroy()}H(),U.empty(this)},pop:function(){if(0!==this.length){var e=U.pop(this);return e.$umount(),e}},push:function(e){for(var t=e.state,r=e.key,n=e.anchor,a=[],o=arguments.length-1;o-- >0;)a[o]=arguments[o+1];var i=[];z();for(var s=0,u=a;s<u.length;s+=1){var c=u[s];U.push(i,c.$mount({parent:t,key:r}))}return 0===this.length?pe.after.apply(pe,[n].concat(i)):pe.after.apply(pe,[this[this.length-1].$ctx.nodeInfo.placeholder].concat(i)),H(),U.push.apply(U,[this].concat(a))},remove:function(e){if(-1!==this.indexOf(e))return e.$umount(),e},reverse:function(e){var t=e.state,r=e.key,n=e.anchor;if(0===this.length)return this;var a=U.copy(this),o=[];z();for(var i=a.length-1;i>=0;i--)a[i].$umount(),U.push(o,a[i].$mount({parent:t,key:r}));return U.push.apply(U,[this].concat(U.reverse(a))),pe.after.apply(pe,[n].concat(o)),H(),this},shift:function(){if(0!==this.length){var e=U.shift(this);return e.$umount(),e}},sort:function(e,t){var r=e.state,n=e.key,a=e.anchor;if(0===this.length)return this;var o=U.copy(U.sort(this,t)),i=[];z();for(var s=0,u=o;s<u.length;s+=1){var c=u[s];c.$umount(),U.push(i,c.$mount({parent:r,key:n}))}return U.push.apply(U,[this].concat(o)),pe.after.apply(pe,[a].concat(i)),H(),this},splice:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(0===this.length)return this;var r=U.splice.apply(U,[U.copy(this)].concat(e));z();for(var n=0,a=r;n<a.length;n+=1){a[n].$umount()}return H(),r},unshift:function(e){for(var t,r=e.state,n=e.key,a=e.anchor,o=[],i=arguments.length-1;i-- >0;)o[i]=arguments[i+1];if(0===this.length)return(t=this).push.apply(t,o).length;var s=[];z();for(var u=0,c=o;u<c.length;u+=1){var l=c[u];U.push(s,l.$mount({parent:r,key:n}))}return pe.after.apply(pe,[a].concat(s)),H(),U.unshift.apply(U,[this].concat(o))}},he=function(e){var t=e.state,r=e.key,n=e.children,a=e.anchor;Object.defineProperty(t,r,{get:function(){return n[r]},set:function(e){!function(e){var t=e.state,r=e.children,n=e.key,a=e.anchor,o=e.value;r[n]!==o&&(o&&(o.$ctx.nodeInfo.parent,o.$ctx.nodeInfo.element.contains(t.$ctx.nodeInfo.element))||(z(),r[n]&&r[n].$umount(),r[n]=o,o&&o.$mount({target:a,parent:t,option:"before",key:n}),H()))}({state:t,children:n,key:r,anchor:a,value:e})},enumerable:!0,configurable:!0})},de=function(e){var t,r,n=e.state,a=e.key,o=e.children,i=e.anchor;o[a]=(t=[],r={state:n,key:a,anchor:i},Object.defineProperties(t,{empty:{value:fe.empty},pop:{value:fe.pop},push:{value:fe.push.bind(t,r)},remove:{value:fe.remove},reverse:{value:fe.reverse.bind(t,r)},shift:{value:fe.shift},sort:{value:fe.sort.bind(t,r)},splice:{value:fe.splice},unshift:{value:fe.unshift.bind(t,r)}}),t),Object.defineProperty(n,a,{get:function(){return o[a]},set:function(e){o[a]&&U.equals(o[a],e)||function(e){var t=e.state,r=e.children,n=e.key,a=e.anchor,o=e.value;o=o?U.copy(o):[];var i=document.createDocumentFragment();if(z(),r[n]){for(var s=0,u=o;s<u.length;s+=1){var c=u[s];if(c.$ctx.nodeInfo.element.contains(t.$ctx.nodeInfo.element))return;c.$umount(),pe.append(i,c.$mount({parent:t,key:n}))}for(var l=0,p=U.copy(r[n]);l<p.length;l+=1)p[l].$umount()}else for(var f=0,h=o;f<h.length;f+=1){var d=h[f];pe.append(i,d.$mount({parent:t,key:n}))}r[n].length=0,U.push.apply(U,[r[n]].concat(o)),pe.after(a,i),H()}({state:n,children:o,key:a,anchor:i,value:e})},enumerable:!0,configurable:!0})},ve=function(e){var t=e.node,r=e.nodeType,n=e.element,a=e.state,o=e.innerData,i=e.refs,s=e.children,u=e.handlers,c=e.subscribers,l=e.svg,p=e.create;switch(r){case"string":pe.append(n,document.createTextNode(t));break;case"array":"object"===P(t[0])?pe.append(n,p({node:t,state:a,innerData:o,refs:i,children:s,handlers:u,subscribers:c,svg:l,create:p})):function(e){var t=e.node,r=e.state,n=e.handlers,a=e.subscribers,o=e.innerData,i=e.element,s=document.createTextNode(""),u=ee({bind:t,state:r,handlers:n,subscribers:a,innerData:o}),c=u.dataNode,l=u.handlerNode,p=u._key,f=function(){s.textContent=c[p]};l.push(f),Z([f]),pe.append(i,s)}({node:t,state:a,handlers:u,subscribers:c,innerData:o,element:n});break;case"object":var f=document.createTextNode("");if(0===t.t)he({state:a,key:t.n,children:s,anchor:f});else{if(1!==t.t)throw new TypeError("Not a standard ef.js AST: Unknown mounting point type '"+t.t+"'");de({state:a,key:t.n,children:s,anchor:f})}pe.append(n,f);break;default:throw new TypeError("Not a standard ef.js AST: Unknown node type '"+r+"'")}},ge=function(e){var t=e.node,r=e.state,n=e.innerData,a=e.refs,o=e.children,i=e.handlers,s=e.subscribers,u=e.svg,c=e.create,l=t[0],p=t.slice(1);u||"svg"!==l.t||(u=!0);for(var f=function(e){var t=e.info,r=e.state,n=e.innerData,a=e.refs,o=e.handlers,i=e.subscribers,s=e.svg,u=t.t,c=t.a,l=t.p,p=t.e,f=t.r,h=ne({tag:u,ref:f,refs:a,svg:s});for(var d in c)ie({element:h,attr:c[d],key:d,state:r,handlers:o,subscribers:i,innerData:n});for(var v in l)se({element:h,prop:l[v],key:v,state:r,handlers:o,subscribers:i,innerData:n});for(var g in p)ce({element:h,event:p[g],state:r,handlers:o,subscribers:i,innerData:n});return h}({info:l,state:r,innerData:n,refs:a,handlers:i,subscribers:s,svg:u}),h=0,d=p;h<d.length;h+=1){var v=d[h];ve({node:v,nodeType:P(v),element:f,state:r,innerData:n,refs:a,children:o,handlers:i,subscribers:s,svg:u,create:c})}return f},be={BEFORE:"before",AFTER:"after",APPEND:"append",REPLACE:"replace"},ye=function(){function e(e){var t={},r={},n={},a={},o={placeholder:document.createTextNode(""),replace:[],parent:null,key:null},i=document.createDocumentFragment(),s=function(){if(o.replace.length>0){for(var e=0,t=o.replace;e<t.length;e+=1){var r=t[e];pe.remove(r)}U.empty(o.replace)}pe.before(o.placeholder,o.element)},u={mount:s,refs:t,innerData:r,methods:{},handlers:n,subscribers:a,nodeInfo:o,safeZone:i};Object.defineProperty(this,"$ctx",{get:function(){return u}}),z(),V(["$data"],this,!1),o.element=ge({node:e,state:this,innerData:r,refs:t,children:{},handlers:n,subscribers:a,svg:!1,create:ge}),pe.append(i,o.placeholder),J(s),H()}var t={$methods:{configurable:!0},$refs:{configurable:!0}};return t.$methods.get=function(){return this.$ctx.methods},t.$methods.set=function(e){var t=this.$ctx.methods;Q(t,e)},t.$refs.get=function(){return this.$ctx.refs},e.prototype.$mount=function(e){var t=e.target,r=e.option,n=e.parent,a=e.key,o=this.$ctx,i=o.nodeInfo,s=o.mount;if("string"==typeof t&&(t=document.querySelector(t)),z(),i.parent&&this.$umount(),n||(n=t),a||(a="__DIRECTMOUNT__"),i.parent=n,i.key=a,J(s),!t)return H(),i.placeholder;switch(r){case be.BEFORE:pe.before(t,i.placeholder);break;case be.AFTER:pe.after(t,i.placeholder);break;case be.REPLACE:pe.before(t,i.placeholder),i.replace.push(t);break;case be.APPEND:default:pe.append(t,i.placeholder)}return H()},e.prototype.$umount=function(){var e=this.$ctx,t=e.nodeInfo,r=e.safeZone,n=e.mount,a=t.parent,o=t.key;if(t.parent=null,t.key=null,z(),a&&"__DIRECTMOUNT__"!==o&&a[o]){if(!Array.isArray(a[o]))return a[o]=null,H();U.remove(a[o],this)}return pe.append(r,t.placeholder),J(n),H()},e.prototype.$subscribe=function(e,t){var r=this.$ctx,n=r.handlers,a=r.subscribers,o=r.innerData,i=e.split("."),s=ee({bind:[i],state:this,handlers:n,subscribers:a,innerData:o}),u=s.dataNode,c=s.subscriberNode,l=s._key;z();try{t({state:this,value:u[l]}),c.push(t)}catch(e){console.error("[EF]","Error caught when registering subscriber:\n",e)}H()},e.prototype.$unsubscribe=function(e,t){!function(e,t,r){var n=function(e,t){for(var r=e.split("."),n=r.pop(),a=0,o=r;a<o.length;a+=1){var i=o[a];t[i]||(t[i]={}),t=t[i]}return t[n]}(e,r);U.remove(n,t)}(e,t,this.$ctx.subscribers)},e.prototype.$update=function(e){z();var t=Q({},e);t.$data&&(Q(this.$data,t.$data),delete t.$data),t.$methods&&(Q(this.$methods,t.$methods),delete t.$methods),Q(this,t),H()},e.prototype.$destroy=function(){var e=this.$ctx.nodeInfo;for(var t in z(),this.$umount(),this)this[t]=null,delete this[t];return J(function(){pe.remove(e.element),pe.remove(e.placeholder)}),H()},Object.defineProperties(e.prototype,t),e}(),me=j,Ne=function(e){var t=P(e);if("string"===t)e=function(e,t){return t||(t=j),t(e)}(e,me);else if("array"!==t)throw new TypeError("Cannot create new component without proper template or AST!");return function(e){var t=e;return function(e){function r(r){z(),e.call(this,t),r&&this.$update(r),H()}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r}(ye)}(e)};e.t=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return Ne(C.apply(void 0,e))},e.create=Ne,e.onNextRender=function(e){return M.push(e)},e.inform=z,e.exec=H,e.bundle=function(e){z();try{return H(e(z,H))}catch(e){return console.error("[EF]","Error caught when executing bundle:\n",e),H()}},e.isPaused=function(){return K>0},e.setParser=function(e){me=e},e.parseEft=j,e.mountOptions=be,e.version="0.8.1",Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ef.min.js.map
